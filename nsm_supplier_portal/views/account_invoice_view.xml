<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <!--  Supplier Invoices Tree View  -->
        <!--  and  -->
        <!--  Supplier Refunds Tree View  -->

        <record id="view_supplier_invoice_tree" model="ir.ui.view">
                <field name="name">account.invoice.tree</field>
                <field name="model">account.invoice</field>
                <field name="type">tree</field>
                <field name="priority" eval="1000"/>
                <field name="arch" type="xml">
                    <!--tree string="Supplier Invoices"-->
                    <tree colors="blue:state == 'draft';black:state in ('proforma','proforma2','open');gray:state == 'cancel'" string="Invoice" create="false">
                        <field name="partner_id" string="Supplier"/>
                        <field name="date_invoice"/>
                        <field name="supplier_invoice_number" invisible="0"/>
                        <field name="number" invisible="1"/>
                        <!--<field name="section_id" string="Redactie"/>-->
                        <field name="team_id" string="Redactie"/>
                        <field name="reference" invisible="1"/>
                        <field name="name" invisible="1"/>
                        <field name="journal_id" invisible="1"/>
                        <!--<field name="period_id" invisible="1"/>-->
                        <field name="company_id" widget="selection" groups="base.group_multi_company" invisible="1"/>
                        <field name="user_id" string="Opdrachtgever" invisible="0"/>
                        <field name="date_due"/>
                        <field name="origin" invisible="1"/>
                        <field name="residual" sum="Residual Amount"/>
                        <field name="amount_untaxed" sum="Untaxed Amount"/>
                        <field name="amount_total" sum="Total Amount"/>
                        <field name="state"/>
                    </tree>
                </field>
        </record>

        <!--Analytic Account tree view for Supplier Portal Users-->
        <record id="view_account_analytic_account_list_portal" model="ir.ui.view">
            <field name="name">account.analytic.account.list</field>
            <field name="model">account.analytic.account</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <tree string="Analytic Accounts">
                    <field name="display_name"/>
                    <field name="department_id" string="Department"/>
                    <field name="code"/>
                    <field name="portal_main" string="Portal"/>
                    <field name="portal_sub" string="Portal"/>
                    <field name="partner_id"/>
                    <field name="active" invisible="1"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                </tree>
            </field>
        </record>

    <!--  Enter Your Invoice View  -->

        <record id="view_supplier_invoice_tree_create" model="ir.ui.view">
                <field name="name">account.invoice.tree</field>
                <field name="model">account.invoice</field>
                <field name="type">tree</field>
                <field name="priority" eval="1000"/>
                <field name="arch" type="xml">
                    <tree colors="blue:topf != True;green:topf == True; gray:state == 'cancel'" string="Invoice">
                        <field name="partner_id" string="Supplier"/>
                        <field name="date_invoice" invisible="1"/>
                        <field name="supplier_invoice_number" invisible="0"/>
                        <field name="product_category" string="Invoice Category" invisible="0"/>
                        <field name="main_account_analytic_id" string="Titel" invisible="0"/>
                        <field name="file" invisible="0"/>
                        <field name="terms" string="Hergebruik" invisible="0"/>
                        <field name="number" invisible="1"/>
                        <field name="is_submitted" invisible="1"/>
                        <field name="is_portal" invisible="1"/>
                        <field name="topf" invisible="1"/>
                        <field name="reference" invisible="1"/>
                        <field name="name" invisible="1"/>
                        <field name="journal_id" invisible="1"/>
                        <field name="user_id" invisible="1"/>
                        <field name="date_due" invisible="1"/>
                        <field name="origin" invisible="1"/>
                        <field name="residual" sum="Residual Amount"/>
                        <field name="amount_untaxed" sum="Untaxed Amount"/>
                        <field name="amount_total" sum="Total Amount"/>
                        <field name="state"/>
                    </tree>
                </field>
        </record>

        <record id="view_custom_supplier_invoice_form" model="ir.ui.view">
            <field name="name">account.invoice.form</field>
            <field name="model">account.invoice</field>
            <field name="type">form</field>
            <field name="priority" eval="2000"/>
            <field name="arch" type="xml">
            <form string="Enter Your Invoice"  create="false">
                <header>
                    <button name="action_portal_submit" string="Submit" class="oe_highlight" type="object" attrs="{'invisible': [('state','!=', 'portalcreate')]}"/>
                    <button name="%(account.action_account_invoice_refund)d" type='action' string='Ask Refund' 
                    attrs="{'invisible': ['|',('type', 'in', ['in_refund','out_refund']),('state','not in',('open','in_payment','paid'))]}"/>
                   
                    <button name="action_invoice_cancel" type="object" states="draft" string="Cancel Invoice" groups="account.group_account_invoice"/>
                    <button name="action_invoice_draft" states="cancel" string="Set to Draft" type="object" />
                    <!--<button name='(account.action_account_state_open)d' type='action' string='Re-Open'  attrs="{'invisible':['|', ('state','&lt;&gt;','paid'), ('reconciled', '=', True)]}" help="This button only appears when the state of the invoice is 'paid' (showing that it has been fully reconciled) and auto-computed boolean 'reconciled' is False (depicting that it's not the case anymore). In other words, the invoice has been dereconciled and it does not fit anymore the 'paid' state. You should press this button to re-open it and let it continue its normal process after having resolved the eventual exceptions it may have created." invisible="1"/>-->
                    <field name="state" widget="statusbar" statusbar_visible="portalcreate,draft,auth,open,paid" statusbar_colors='{"proforma":"blue","proforma2":"blue"}'/>
                </header>
                <sheet string="Supplier Invoice">
                    <div>
                     <span class="o_form_label" attrs="{'invisible': ['|', '|', ('state','&lt;&gt;','draft'),('type','&lt;&gt;','in_invoice'),  ('is_submitted','=', False), ]}">Draft Invoice</span>
                        <span class="o_form_label" attrs="{'invisible': ['|', ('state','&lt;&gt;','draft'), ('is_submitted','!=', True)]}" readonly="1">- Submitted Invoice</span>
                        <span class="o_form_label" attrs="{'invisible': ['|','|', ('state','&lt;&gt;','draft'), ('type','&lt;&gt;','in_refund'), ('is_submitted','=', True)]}">Draft Refund</span>
                        <span class="o_form_label" attrs="{'invisible': ['|',('state', '=', 'draft'), ('type','&lt;&gt;','in_invoice')]}">Invoice </span>
                        <span class="o_form_label"  attrs="{'invisible': ['|',('state', '=', 'draft'), ('type','&lt;&gt;','in_refund')]}">Refund </span>
                        <h1>
                            <field name="number" class="oe_inline"  attrs="{'invisible': [('state', '=', 'draft')]}"/>
                            <field name="is_submitted" invisible="1"/>
                            <field name="is_portal" invisible="1"/>
                            <field name="topf" invisible="1"/>
                        </h1>
                    </div>
                    <field name="type" invisible="1"/>
                    <group>
                        <group>
                            <field name="payment_term_id" widget="selection" invisible="1"/>
                            <field domain="[('partner_id', '=', partner_id)]" name="partner_bank_id" invisible="1"/>
                            <field name="company_id" widget="selection" invisible="1"/>
                            <field name="supplier_id" select="1" readonly="1"
                                   context="{'form_view_ref':'nsm_supplier_portal.view_partner_supplier_form', 'is_portal': True}"
                                   attrs="{'invisible':[('type', '=', 'in_refund')]}"/>

                            <field name="reference" invisible="1"/>
                            <field name="payment_mode_id" invisible="1"/>
                            <field name="partner_id"
                                  context="{'default_customer': 0, 'search_default_supplier': 1, 'default_supplier': 1, 'form_view_ref':'nsm_supplier_portal.view_partner_supplier_form', 'is_portal': True}"
                                  domain="[('supplier', '=', True)]" attrs="{'invisible':[('type', '!=', 'in_refund')], 'readonly': [('type','=','in_refund')]}"/>

                            <field name="supplier_invoice_number" required="1"
                        />
                            <field name="product_category"  required="True"
                               options='{"no_create": True, "no_create_edit": True, "no_open": True}' attrs="{'readonly': [('state','!=','portalcreate')],}"/>
                            <field name="main_account_analytic_id"
                               options='{"no_create": True, "no_create_edit": True, "no_open": True}' required="True"
                               attrs="{'readonly': [('state','!=','portalcreate')],}"
                               context="{'tree_view_ref': 'nsm_supplier_portal.view_account_analytic_account_list_portal'}"/>

                            <field name="operating_unit_id" groups="operating_unit.group_multi_operating_unit" attrs="{'readonly': [('state','!=','portalcreate')]}" options='{"no_create": True, "no_create_edit": True, "no_open": True}'/>

                            <field name="team_id"  widget="selection" readonly="1" invisible="1"/>
                            <field name="fiscal_position_id" widget="selection" invisible="1"/>
                            <field name="origin" invisible="1"/>
                            <!--label for="reference_type"/>
                            <div>
                                <field name="reference_type" class="oe_inline oe_edit_only" invisible="1"/>
                                <field name="reference" class="oe_inline" invisible="1"/>
                            </div-->
                        </group>
                        <group>
                            <field name="date_invoice" invisible="1"/>
                            <field name="date_due" invisible="1"/>
                            <field domain="[('company_id', '=', company_id), ('type', '=', 'payable')]"
                                name="account_id" invisible="1"/>
                            <field name="journal_id"
                                widget="selection" invisible="1"/>
                            <field name="currency_id" invisible="1"/>
                            <field name="check_total" groups="account_invoice_check_total.group_supplier_inv_check_total" attrs="{'readonly': [('is_submitted','=',True)]}"/>
                        </group>
                        <field name="tax_line_ids" attrs="{'readonly': [('state','not in',('portalcreate','draft'))],}" invisible="1"/>
                    </group>
                    <notebook>
                        <page string="Invoice">
                            <field context="{'partner_id': partner_id, 'price_type': context.get('price_type') or False, 'type': type, 'is_portal': True, 'journal_id': journal_id}"
                                   name="invoice_line_ids" attrs="{'readonly': [('state','!=','portalcreate')]}">
                                <tree string="Invoice lines" editable="bottom">
                                    <field name="sequence" widget="handle" />
                                    <field name="product_id" domain="[('categ_id', '=', parent.product_category)]"  required="1"
                                        options='{"no_create": True, "no_create_edit": True, "no_open": True}'/>

                                    <field name="name"/>
                                    <field name="company_id" invisible="1"/>

                                    <field name="account_id" invisible="1"
                                        domain="[('company_id', '=', parent.company_id), ('journal_id', '=', parent.journal_id), ('type', '=', 'other')]"
                                        options='{"no_open": True}'/>

                                    <field name="acc_analytic_domain" invisible="1"/>
                                    <field name="account_analytic_id"
                                        domain="acc_analytic_domain"
                                        options='{"no_create": True, "no_create_edit": True, "no_open": True}' required="True"
                                        context="{'tree_view_ref': 'nsm_supplier_portal.view_account_analytic_account_list_portal'}"/>

                                    <field name="quantity"/>
                        
                                    <field name="price_unit"/>
                                    <field name="discount" invisible="1"/>
                                    <field name="new_tax_id" context="{'type':parent.type}"
                                        domain="[('company_id', '=', parent.company_id)]"
                                        options='{"no_create": True, "no_create_edit": True, "no_open": True}'/>

                                    <field name="invoice_line_tax_ids" widget="many2many_tags" context="{'type':parent.type}"
                                        domain="[('company_id', '=', parent.company_id)]"
                                        options='{"no_create": True, "no_create_edit": True, "no_open": True}' invisible="1"/>

                                    <field name="price_subtotal"/>
                                </tree>
                            </field>

                            <group>
                                <group>
                                    <field name="data_file" invisible="1"/>
                                    <field name="file" filename="data_file" attrs="{'readonly': [('is_submitted','=',True)]}"/>
                                    <field name="reuse" invisible="1"/>
                                    <field name="data_supplier_terms_file_name" invisible="1"/>
                                    <field name="supplier_terms" readonly="1" filename="data_supplier_terms_file_name" attrs="{'invisible': [('reuse','=', False)]}"/>
                                    <field name="terms" attrs="{'readonly': [('is_submitted','=',True)], 'invisible': [('reuse', '=', False)]}"/>
                                </group>
                                <group class="oe_subtotal_footer oe_right">
                                    <field name="amount_untaxed"/>
                                    <field name="amount_tax"/>
                                    <field name="amount_total" class="oe_subtotal_footer_separator"/>
                                    <field name="payments_widget" colspan="2" nolabel="1" widget="payment"/>
                                    <field name="residual" class="oe_subtotal_footer_separator" attrs="{'invisible': [('state', '=', 'draft')]}"/>
                                    <field name="reconciled" invisible="1"/>
                                    <field name="outstanding_credits_debits_widget" colspan="2" nolabel="1" widget="payment" attrs="{'invisible': [('state', 'not in', 'open')]}"/>
                                </group>
                            </group>
                            <div>
                                <field name="comment" placeholder="Additional notes..." attrs="{'readonly': [('is_submitted','=',True)]}"/>
                            </div>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                    <field name="message_ids" widget="mail_thread" nolabel="1"/>
                </div>
            </form>
            </field>
        </record>

        <record model="ir.actions.act_window" id="act_open_custom_supplier_invoice_view">
            <field name="name">Enter Your Invoice</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('type','=','in_invoice'), ('state', '=', 'portalcreate')]</field>
            <field name="context">{'default_type': 'in_invoice', 'type': 'in_invoice', 'journal_type': 'purchase', 'is_portal': True, 'state': 'portalcreate', 'readonly_by_pass': True}</field>
        </record>

        <record model="ir.actions.act_window.view" id="act_open_custom_supplier_invoice_view_form">
            <field name="act_window_id" ref="act_open_custom_supplier_invoice_view"/>
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_custom_supplier_invoice_form"/>
        </record>

        <record model="ir.actions.act_window.view" id="act_open_custom_supplier_invoice_view_tree">
            <field name="act_window_id" ref="act_open_custom_supplier_invoice_view"/>
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_supplier_invoice_tree_create"/>
        </record>


    <!--  Supplier Invoices View  -->
       <record id="view_supplier_invoice_submitted_tree_create" model="ir.ui.view">
            <field name="name">account.invoice.tree</field>
            <field name="model">account.invoice</field>
            <field name="type">tree</field>
            <field name="priority" eval="1000"/>
            <field name="arch" type="xml">
                <tree colors="blue:state == 'draft';black:state in ('proforma','proforma2','auth');green:state == 'paid';purple:state == 'open';gray:state == 'cancel'" create="false" string="Invoice">
                    <field name="partner_id" />
                    <field name="date_invoice"/>
                    <field name="supplier_invoice_number" invisible="0"/>
                    <field name="number"/>
                    <field name="team_id" />
                    <field name="is_submitted" invisible="True"/>
                    <field name="reference" invisible="1"/>
                    <field name="name" invisible="1"/>
                    <field name="journal_id" invisible="1"/>
                    <field name="company_id" widget="selection" groups="base.group_multi_company" invisible="1"/>
                    <field name="user_id"  invisible="0"/>
                    <field name="date_due"/>
                    <field name="origin" invisible="1"/>
                    <field name="currency_id" groups="base.group_multi_currency"/>
                    <field name="residual" sum="Residual Amount"/>
                    <field name="amount_untaxed" sum="Untaxed Amount"/>
                    <field name="amount_total" sum="Total Amount"/>
                    <field name="state"/>
                </tree>
            </field>
       </record>
       <record id="view_custom_supplier_supplier_invoice_form" model="ir.ui.view">
            <field name="name">account.invoice.form</field>
            <field name="model">account.invoice</field>
            <field name="type">form</field>
            <field name="priority" eval="2000"/>
            <field name="arch" type="xml">
            <form string="Supplier Invoice" editable="false" create="false">
                <header>
                    <!--button name="act_submit" string="Submit"
                    class="oe_highlight" type="object" attrs="{'invisible':
                    [('is_submitted','=', True)]}"/-->
                    <button name="%(account.action_account_invoice_refund)d" type='action' string='Ask Refund'
                            attrs="{'invisible': ['|',('type', 'in', ['in_refund','out_refund']),('state','not in',('open','paid'))]}"
                            invisible="1"/>
                    <button name="action_invoice_cancel" states="draft" string="Cancel Invoice"/>
                    <button name="action_invoice_draft" states="cancel" string="Set to Draft" type="object" />
                    <!--<button name='(account.action_account_state_open)d' type='action' string='Re-Open'  attrs="{'invisible':['|', ('state','&lt;&gt;','paid'), ('reconciled', '=', True)]}" help="This button only appears when the state of the invoice is 'paid' (showing that it has been fully reconciled) and auto-computed boolean 'reconciled' is False (depicting that it's not the case anymore). In other words, the invoice has been dereconciled and it does not fit anymore the 'paid' state. You should press this button to re-open it and let it continue its normal process after having resolved the eventual exceptions it may have created." invisible="1"/>-->
                    <field name="state" widget="statusbar" statusbar_visible="portalcreate,draft,auth,open,paid" statusbar_colors='{"proforma":"blue","proforma2":"blue"}'/>
                </header>
                <sheet string="Supplier Invoice">
                  
                    <div>
                     <span class="o_form_label" attrs="{'invisible': ['|', '|', ('state','&lt;&gt;','draft'),('type','&lt;&gt;','in_invoice'),  ('is_submitted','=', False), ]}">Draft Invoice</span>
                        <span class="o_form_label" attrs="{'invisible': ['|', ('state','&lt;&gt;','draft'), ('is_submitted','!=', True)]}" readonly="1">- Submitted Invoice</span>
                        <span class="o_form_label" attrs="{'invisible': ['|','|', ('state','&lt;&gt;','draft'), ('type','&lt;&gt;','in_refund'), ('is_submitted','=', True)]}">Draft Refund</span>
                        <span class="o_form_label" attrs="{'invisible': ['|',('state', '=', 'draft'), ('type','&lt;&gt;','in_invoice')]}">Invoice </span>
                        <span class="o_form_label"  attrs="{'invisible': ['|',('state', '=', 'draft'), ('type','&lt;&gt;','in_refund')]}">Refund </span>
                        <h1>
                            <field name="number" class="oe_inline"  attrs="{'invisible': [('state', '=', 'draft')]}"/>
                            <field name="is_submitted" invisible="1"/>
                            <field name="is_portal" invisible="1"/>
                            <field name="supplier_ref_related" class="oe_inline" attrs="{'invisible': ['|', ('state','&lt;&gt;','draft'), ('is_submitted','!=', True)]}" readonly="1"/>
                        </h1>
                    </div>
                        
                    <field name="type" invisible="1"/>
                    <group>
                        <group>
                            <field name="payment_term_id" widget="selection" invisible="1"/>
                            <field domain="[('partner_id', '=', partner_id)]" name="partner_bank_id" on_change="onchange_partner_bank(partner_bank_id)" invisible="1"/>
                            <!--<field name="company_id" on_change="onchange_company_id(company_id,partner_id,type,invoice_line,currency_id)" widget="selection" invisible="1"/>-->
                            <field name="company_id" on_change="onchange_company_id(company_id,partner_id,type,invoice_line_ids,currency_id)" widget="selection" invisible="1"/>
                            <field name="supplier_id" select="1" readonly="1" on_change="supplier_id_change(supplier_id,context)" context="{'form_view_ref':'nsm_supplier_portal.view_partner_supplier_form', 'is_portal': True}" attrs="{'invisible':[('type', '=', 'in_refund')]}"/>
                            <field name="partner_id"
                              on_change="onchange_partner_id(type,partner_id,date_invoice,payment_term_id, partner_bank_id,company_id)"
                              context="{'default_customer': 0, 'search_default_supplier': 1, 'default_supplier': 1}"
                              domain="[('supplier', '=', True)]" attrs="{'invisible':[('type', '!=', 'in_refund')]}"/>

                            <field name="supplier_invoice_number" invisible="0" required="1"/>

                            <field name="product_category" required="True"
                               domain="[('parent_id.supportal', '=', True)]"
                               options='{"no_create": True, "no_create_edit": True, "no_open": True}'
                               attrs="{'readonly': [('state','!=','draft')],}"/>

                            <field name="main_account_analytic_id" string="Titel/Afdeling"
                               options='{"no_create": True, "no_create_edit": True, "no_open": True}' required="True"
                               attrs="{'readonly': [('state','!=','draft')],}"/>

                            <field name="operating_unit_id" groups="operating_unit.group_multi_operating_unit" attrs="{'readonly': [('state','!=','draft')],}" options='{"no_create": True, "no_create_edit": True, "no_open": True}'/>

                            <field name="team_id" string="Redactie/Afdeling" widget="selection" readonly="True" />
                            <field name="fiscal_position_id" widget="selection" invisible="1"/>
                            <field name="origin" invisible="1"/>
                        </group>
                        <group>
                            <field name="date_invoice" invisible="1"/>
                            <field name="date_due" invisible="1"/>
                            <field domain="[('company_id', '=', company_id), ('type', '=', 'payable')]"
                                name="account_id" invisible="1"/>
                            <!--<field name="journal_id"-->
                                <!--on_change="onchange_journal_id(journal_id, context)" widget="selection" invisible="1"/>-->

                            <field name="journal_id"
                                widget="selection" invisible="1"/>
                            <field name="currency_id" invisible="1"/>
                            <field name="check_total" groups="account_invoice_check_total.group_supplier_inv_check_total"/>
                        </group>
                        <field name="tax_line_ids" attrs="{'readonly': [('state','not in',('portalcreate','draft'))],}" invisible="1"/>
                    </group>
                    <notebook>
                        <page string="Invoice">
                            <field context="{'partner_id': partner_id, 'price_type': context.get('price_type') or False, 'type': type, 'is_portal': True, 'journal_id': journal_id}"
                                   name="invoice_line_ids" attrs="{'readonly': [('state','!=','draft')]}">
                                <tree string="Invoice lines" editable="bottom">
                                    <field name="sequence" widget="handle" />

                                    <field name="product_id" domain="[('categ_id', '=', parent.product_category)]"  required="1"
                                        options='{"no_create": True, "no_create_edit": True, "no_open": True}'/>
                                    <field name="name"/>
                                    <field name="company_id" invisible="1"/>
                                    <field name="account_id" invisible="1"
                                        domain="[('company_id', '=', parent.company_id), ('journal_id', '=', parent.journal_id), ('type', '=', 'other')]"
                                        on_change="onchange_account_id(product_id, parent.partner_id, parent.type, parent.fiscal_position_id,account_id)" options='{"no_open": True}'/>

                                    <field name="account_analytic_id"
                                        domain="[('company_id', '=', parent.company_id), ('portal_sub', '=', True)]"
                                        options='{"no_create": True, "no_create_edit": True, "no_open": True}' required="True"/>

                                    <field name="quantity"/>

                                    <field name="price_unit"/>
                                    <field name="discount" invisible="1"/>
                                    <field name="new_tax_id" context="{'type':parent.type}"
                                        domain="[('company_id', '=', parent.company_id)]"
                                        options='{"no_create": True, "no_create_edit": True, "no_open": True}'/>

                                    <field name="invoice_line_tax_ids" widget="many2many_tags" context="{'type':parent.type}"
                                        domain="[('company_id', '=', parent.company_id)]"
                                        options='{"no_create": True, "no_create_edit": True, "no_open": True}' invisible="1"/>

                                    <field name="price_subtotal"/>
                                </tree>
                            </field>
                            <group>
                                <group>
                                    <field name="data_file" invisible="1"/>
                                    <field name="file" filename="data_file" attrs="{'readonly': [('is_submitted','=',True)]}"/>
                                    <field name="reuse" invisible="1"/>
                                    <field name="data_supplier_terms_file_name" invisible="1"/>
                                    <field name="supplier_terms" readonly="1" filename="data_supplier_terms_file_name" attrs="{'invisible': [('reuse','=', False)]}"/>
                                    <field name="terms" attrs="{'readonly': [('is_submitted','=',True)], 'invisible': [('reuse', '=', False)]}"/>
                                </group>
                                <group class="oe_subtotal_footer oe_right">
                                    <field name="amount_untaxed"/>
                                    <field name="amount_tax"/>
                                    <field name="amount_total" class="oe_subtotal_footer_separator"/>
                                    <field name="payments_widget" colspan="2" nolabel="1" widget="payment"/>
                                    <field name="residual" class="oe_subtotal_footer_separator" attrs="{'invisible': [('state', '=', 'draft')]}"/>
                                    <field name="reconciled" invisible="1"/>
                                    <field name="outstanding_credits_debits_widget" colspan="2" nolabel="1" widget="payment" attrs="{'invisible': [('state', 'not in', 'open')]}"/>
                                </group>
                            </group>
                            <div>
                                <field name="comment" placeholder="Additional notes..." />
                            </div>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                    <field name="message_ids" widget="mail_thread" nolabel="1"/>
                </div>
            </form>
            </field>
       </record>

       <record model="ir.actions.act_window" id="act_open_supplier_invoice_view">
            <field name="name">Supplier Invoices</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">['&amp;',('type','=','in_invoice'),'|',('state','not in',['cancel','draft','portalcreate']),'&amp;', ('state','=','draft'),('is_portal','=', True)]</field>
            <field name="context">{'default_type': 'in_invoice', 'type': 'in_invoice', 'journal_type': 'purchase', 'is_portal': True}</field>
       </record>
       <record model="ir.actions.act_window.view" id="act_open_supplier_invoice_view_form">
            <field name="act_window_id" ref="act_open_supplier_invoice_view"/>
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_custom_supplier_supplier_invoice_form"/>
       </record>

       <record model="ir.actions.act_window.view" id="act_open_supplier_invoice_view_tree">
            <field name="act_window_id" ref="act_open_supplier_invoice_view"/>
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_supplier_invoice_submitted_tree_create"/>
       </record>


        <!--  Submited Invoice from Supplier   -->

       <record id="view_custom_supplier_invoice_submited_form" model="ir.ui.view">
            <field name="name">account.invoice.form</field>
            <field name="model">account.invoice</field>
            <field name="type">form</field>
            <field name="priority" eval="2000"/>
            <field name="arch" type="xml">
            <form string="Submitted Invoice"  create="false">
                <header>
                    <button name="action_invoice_open" type="object" states="draft" string="Validate" class="oe_highlight"/>
                    <button name="action_portalback"  type="object" string="Terug Portal" attrs="{'invisible': ['|',('state','!=','draft'),('topf','=',True)],}"/>
                    <button name="%(account.action_account_invoice_refund)d" type='action' string='Ask Refund'
                            attrs="{'invisible': ['|',('type', 'in', ['in_refund','out_refund']),('state','not in',('open','paid'))]}"
                            invisible="1"/>
                    <button name="action_invoice_cancel" states="draft" string="Cancel Invoice"/>
                    <button name="action_invoice_draft" states="cancel" string="Set to Draft" type="object" />
                    <!--<button name='(account.action_account_state_open)d' type='action' string='Re-Open'  attrs="{'invisible':['|', ('state','&lt;&gt;','paid'), ('reconciled', '=', True)]}" help="This button only appears when the state of the invoice is 'paid' (showing that it has been fully reconciled) and auto-computed boolean 'reconciled' is False (depicting that it's not the case anymore). In other words, the invoice has been dereconciled and it does not fit anymore the 'paid' state. You should press this button to re-open it and let it continue its normal process after having resolved the eventual exceptions it may have created." invisible="1"/>-->
                    <field name="state" widget="statusbar" statusbar_visible="portalcreate,draft,open,auth,paid" statusbar_colors='{"proforma":"blue","proforma2":"blue"}'/>
                </header>
                <sheet string="Supplier Invoice">
                    <div>   
                    <span class="o_form_label" attrs="{'invisible': ['|', '|', ('state','&lt;&gt;','draft'),('type','&lt;&gt;','in_invoice'), ('is_submitted','=', False)]}">Draft Bill</span>
                        <span class="o_form_label" attrs="{'invisible': ['|', '|', ('state','&lt;&gt;','draft'), ('type','in ',['in_refund','in_invoice']), ('is_portal','!=', True), ]}">- Submitted Bill</span>
                        <span class="o_form_label" attrs="{'invisible': ['|','|', ('state','&lt;&gt;','draft'), ('type','&lt;&gt;','in_refund'), ('is_submitted','=', True)]}">Draft Refund</span>
                        <span class="o_form_label" attrs="{'invisible': ['|',('state', '=', 'draft'), ('type','&lt;&gt;','in_invoice')]}">Bill </span>
                       <span class="o_form_label"  attrs="{'invisible': ['|',('state', '=', 'draft'), ('type','&lt;&gt;','in_refund')]}">Refund </span>             
                                                             
                    <h1>
                    <field name="supplier_ref_related" class="oe_inline" attrs="{'invisible': ['|', ('state','&lt;&gt;','draft'), ('is_submitted','!=', True)]}" readonly="1"/>
                    <field name="number" class="oe_inline"  attrs="{'invisible': [('state', '=', 'draft')]}"/>
                   <field name="is_submitted" invisible="1"/>
                    <field name="type" invisible="1"/>
                    <field name="is_portal" invisible="1"/>
                    <field name="topf" invisible="1"/>
                    </h1> </div>
                    <group>
                        <group>
                            <field name="payment_term_id" widget="selection" invisible="1"/>
                            <field domain="[('partner_id', '=', partner_id)]" name="partner_bank_id" on_change="onchange_partner_bank(partner_bank_id)" invisible="1"/>
                            <field name="company_id" on_change="onchange_company_id(company_id,partner_id,type,invoice_line_ids,currency_id)" widget="selection" invisible="1"/>
                            <field name="supplier_id" select="1" readonly="1" on_change="supplier_id_change(supplier_id,context)" context="{'form_view_ref':'nsm_supplier_portal.view_partner_supplier_form', 'is_portal': True}" attrs="{'invisible':[('type', '=', 'in_refund')]}"/>
                            <field string="Supplier" name="partner_id"
                              on_change="onchange_partner_id(type,partner_id,date_invoice,payment_term_id, partner_bank_id,company_id)"
                              context="{'default_customer': 0, 'search_default_supplier': 1, 'default_supplier': 1}"
                              domain="[('supplier', '=', True)]" attrs="{'invisible':[('type', '!=', 'in_refund')]}"/>
                            <field name="supplier_invoice_number" invisible="0" required="1" attrs="{'readonly': [('state','!=','draft')]}"/>
                            <field name="product_category" string="Invoice Category" />
                            <field name="main_account_analytic_id" string="Titel/Afdeling"
                               options='{"no_create": True, "no_create_edit": True, "no_open": True}' required="True"
                               attrs="{'readonly': [('state','!=','draft')],}"/>
                            <field name="operating_unit_id" groups="operating_unit.group_multi_operating_unit" attrs="{'readonly': [('state','!=','draft')],}" options='{"no_create": True, "no_create_edit": True, "no_open": True}'/>
                            <field name="fiscal_position_id" widget="selection" invisible="1"/>
                            <field name="origin" invisible="1"/>
                            <!--label for="reference_type"/>
                            <div>
                                <field name="reference_type" class="oe_inline oe_edit_only" invisible="1"/>
                                <field name="reference" class="oe_inline" invisible="1"/>
                            </div-->
                        </group>
                        <group>
                            <field name="date_invoice" invisible="1"/>
                            <field name="date_due" invisible="1"/>
                            <field domain="[('company_id', '=', company_id), ('type', '=', 'payable')]"
                                name="account_id" invisible="1"/>
                            <field name="journal_id"
                                on_change="onchange_journal_id(journal_id, context)" widget="selection" invisible="1"/>
                            <field name="currency_id" invisible="1"/>
                            <field name="check_total" groups="account_invoice_check_total.group_supplier_inv_check_total"/>
                        </group>
                        <field name="tax_line_ids" attrs="{'readonly': [('state','not in',('portalcreate','draft'))],}" invisible="1"/>
                    </group>
                    <notebook>
                        <page string="Invoice">
                            <field context="{'partner_id': partner_id, 'price_type': context.get('price_type') or False, 'type': type, 'is_portal': True, 'journal_id': journal_id}"
                                   name="invoice_line_ids" attrs="{'readonly': [('state','!=','draft')]}">
                                <tree string="Invoice lines" editable="bottom">
                                    <field name="sequence" widget="handle" />

                                    <field name="product_id" options='{"no_create": True, "no_create_edit": True, "no_open": True}'/>
                                    <field name="name"/>
                                    <field name="company_id" invisible="1"/>
                                    <field name="account_id" invisible="1"
                                        domain="[('company_id', '=', parent.company_id), ('journal_id', '=', parent.journal_id), ('type', '=', 'other')]"
                                        options='{"no_open": True}'/>
                                    <field name="account_analytic_id" string="Editie"/>
                                    <field name="quantity"/>

                                    <field name="price_unit"/>
                                    <field name="discount" invisible="1"/>
                                    <field name="new_tax_id" context="{'type':parent.type}"
                                        domain="[('company_id', '=', parent.company_id)]"
                                        options='{"no_create": True, "no_create_edit": True, "no_open": True}'/>

                                    <field name="invoice_line_tax_ids" widget="many2many_tags" context="{'type':parent.type}"
                                        domain="[('company_id', '=', parent.company_id)]"
                                        options='{"no_create": True, "no_create_edit": True, "no_open": True}' invisible="1"/>
                                    <field name="price_subtotal"/>
                                </tree>
                            </field>
                            <group>
                                <group>
                                    <field name="data_file" invisible="1"/>
                                    <field name="file" filename="data_file"/>
                                    <field name="data_supplier_terms_file_name" invisible="1"/>
                                    <field name="supplier_terms" readonly="1"
                                        filename="data_supplier_terms_file_name"/>
                                    <field name="terms"/>
                                </group>

                                <group class="oe_subtotal_footer oe_right">
                                    <field name="amount_untaxed"/>
                                    <field name="amount_tax"/>
                                    <field name="amount_total" class="oe_subtotal_footer_separator"/>
                                    <field name="payments_widget" colspan="2" nolabel="1" widget="payment"/>
                                    <field name="residual" class="oe_subtotal_footer_separator" attrs="{'invisible': [('state', '=', 'draft')]}"/>
                                    <field name="reconciled" invisible="1"/>
                                    <field name="outstanding_credits_debits_widget" colspan="2" nolabel="1" widget="payment" attrs="{'invisible': [('state', 'not in', 'open')]}"/>
                                </group>
                            </group>
                            <div>
                                <field name="comment" placeholder="Additional notes..." attrs="{'readonly': [('is_submitted','=',True)]}"/>
                            </div>
                        </page>
                    </notebook>
                </sheet>
            </form>
            </field>
       </record>

       <record model="ir.actions.act_window" id="act_open_supplier_invoice_submited_view">
            <field name="name">Submitted Supplier Invoices</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('state','=','draft'),('is_portal','=',True),('type','=','in_invoice')]</field>
            <field name="context">{'default_type': 'in_invoice', 'type': 'in_invoice', 'journal_type': 'purchase', 'is_portal': True}</field>
       </record>
       <record model="ir.actions.act_window.view" id="act_open_supplier_invoice_view_submited_form">
            <field name="act_window_id" ref="act_open_supplier_invoice_submited_view"/>
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_custom_supplier_invoice_submited_form"/>
       </record>

       <record model="ir.actions.act_window.view" id="act_open_supplier_invoice_view_submited_tree">
            <field name="act_window_id" ref="act_open_supplier_invoice_submited_view"/>
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_supplier_invoice_tree"/>
       </record>


    <!--  Supplier Refunds View  -->

       <record id="action_invoice_tree4" model="ir.actions.act_window">
            <field name="name">Supplier Refunds</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field ref="view_supplier_invoice_tree" name="view_id"/>
            <field name="domain">[('type','=','in_refund')]</field>
            <field name="context">{'default_type': 'in_refund', 'type': 'in_refund', 'journal_type': 'purchase_refund', 'is_portal': True, 'no_create':True}</field>
            <field name="search_view_id" ref="account.view_account_invoice_filter"/>
       </record>

       <record model="ir.actions.act_window.view" id="act_open_action_invoice_tree4_tree">
            <field name="act_window_id" ref="action_invoice_tree4"/>
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_supplier_invoice_tree"/>
       </record>

       <record model="ir.actions.act_window.view" id="act_open_action_invoice_tree4_form">
            <field name="act_window_id" ref="action_invoice_tree4"/>
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_custom_supplier_invoice_form"/>
       </record>

       <record id="view_account_invoice_filter_portal" model="ir.ui.view">
            <field name="name">invoice.select.nsm_portal</field>
            <field name="model">account.invoice</field>
	        <field name="inherit_id" ref="account_invoice_2step_validation.view_account_invoice_filter_auth"/>
            <field name="arch" type="xml">
                <data>
                    <xpath expr="//search/filter[@name='paid']" position="after">
			            <filter name="portal" string="Portal Invoices" domain="[('is_portal','=',True)]" help="Portal Invoices"/>
                        <filter name="cross_portal" string="Portal Invoices from accounting" domain="[('topf','=',True)]" help="Cross Portal Invoices"/>
		            </xpath>
		        </data>
            </field>
       </record>

       <record id="account.action_invoice_tree2" model="ir.actions.act_window">
            <field name="name">Vendor Bills</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('type','=','in_invoice'), ('state', '!=', 'portalcreate')]</field>
            <field name="context">{'default_type': 'in_invoice', 'type': 'in_invoice', 'journal_type': 'purchase'}</field>
            <field name="search_view_id" ref="account.view_account_invoice_filter"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to record a new supplier invoice.
              </p><p>
                You can control the invoice from your supplier according to
                what you purchased or received. OpenERP can also generate
                draft invoices automatically from purchase orders or receipts.
              </p>
            </field>
       </record>
       <record id="action_invoice_tree_supportal" model="ir.actions.act_window">
            <field name="name">Vendor Bills</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('type','in',('in_invoice', 'in_refund')), ('state','not in',['portalcreate','draft'])]</field>
            <field name="context">{'default_type': 'in_invoice', 'type': 'in_invoice', 'journal_type': 'purchase'}</field>
            <field name="search_view_id" ref="account.view_account_invoice_filter"/>
       </record>

        <record id="action_invoice_tree2_standard" model="ir.actions.act_window">
            <field name="name">Vendor Bills</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,kanban,form,calendar,pivot,graph</field>
            <field eval="False" name="view_id"/>
            <field name="domain">[('type','in',('in_invoice', 'in_refund'))]</field>
            <field name="context">{'default_type': 'in_invoice', 'type': 'in_invoice', 'journal_type': 'purchase'}</field>
            <field name="search_view_id" ref="account.view_account_invoice_filter"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to record a new vendor bill.
              </p><p>
                You can control the invoice from your vendor according to
                what you purchased or received.
              </p>
            </field>
        </record>
        

       <act_window
            context="{'search_default_partner_id':[active_id], 'default_partner_id': active_id}"
            domain="[('state','!=', 'portalcreate')]"
            id="act_res_partner_2_account_invoice_opened"
            name="Invoices"
            res_model="account.invoice"
            src_model="res.partner"/>

       <record id="invoice_supplier_form_NSM_ext" model="ir.ui.view">
            <field name="name">account.invoice.supplier.form.NSM_ext</field>
            <field name="model">account.invoice</field>
            <!--<field name="inherit_id" ref="account_invoice_2step_validation.invoice_supplier_form_auth"/>-->
           <field name="inherit_id" ref="account.invoice_supplier_form"/>
            <field name="arch" type="xml">
                <data>
                    <button name="action_invoice_open" position="after">
                        <button name="action_portalback" states="draft" class="btn-nsm" type="object" string="Terug Portal" />
                    </button>
                </data>
            </field>
        </record>

    </data>
</odoo>
